<?xml version="1.0" encoding="ISO-8859-1"?>
<SunopsisExport>
<Admin RepositoryVersion="05.02.02.08" IsLegacyIdCompatible="false" />
<Encryption algorithm="AES" keyLength="128" exportKeyHash="uxtpm7QzPE4B02xDTl81AReV+wUDW0loAzMMSFGdf8w=" keyVect="9IKSi0iAjzaFYm+CWbnKvg==" exportKeySalt="6d7cda7e-ed97-4721-81b9-00a288da765c" containsCipherText="false"/>
<Object class="com.sunopsis.dwg.dbobj.SnpVar">
		<Field name="DefDate" type="java.sql.Timestamp">null</Field>
	<Field name="DefN" type="com.sunopsis.sql.DbInt">null</Field>
	<Field name="DefV" type="java.lang.String">null</Field>
	<Field name="ExtVersion" type="java.lang.String">null</Field>
	<Field name="FirstDate" type="java.sql.Timestamp"><![CDATA[2019-07-22 17:21:22.0]]></Field>
	<Field name="FirstUser" type="java.lang.String"><![CDATA[SUPERVISOR]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[36a2e0ed-1822-489e-9bf5-8206b43ee78e]]></Field>
	<Field name="IndChange" type="java.lang.String"><![CDATA[I]]></Field>
	<Field name="IndStore" type="java.lang.String"><![CDATA[S]]></Field>
	<Field name="IntVersion" type="com.sunopsis.sql.DbInt"><![CDATA[54]]></Field>
	<Field name="IProject" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ITxtVar" type="com.sunopsis.sql.DbInt"><![CDATA[3617]]></Field>
	<Field name="ITxtVarIn" type="com.sunopsis.sql.DbInt"><![CDATA[3618]]></Field>
	<Field name="ITxtVarValTxt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="IVar" type="com.sunopsis.sql.DbInt"><![CDATA[9]]></Field>
	<Field name="LastDate" type="java.sql.Timestamp"><![CDATA[2019-10-15 20:20:18.0]]></Field>
	<Field name="LastUser" type="java.lang.String"><![CDATA[SUPERVISOR]]></Field>
	<Field name="LschemaName" type="java.lang.String"><![CDATA[REPOS_ODI_EXEC]]></Field>
	<Field name="VarDatatype" type="java.lang.String"><![CDATA[T]]></Field>
	<Field name="VarName" type="java.lang.String"><![CDATA[GET_LP_WARNING_MSG]]></Field>
	<Field name="VarType" type="java.lang.String"><![CDATA[G]]></Field>
	<Field name="VLastDate" type="java.sql.Timestamp">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpTxtHeader">
		<Field name="Enc" type="java.lang.String">null</Field>
	<Field name="EncKey" type="java.lang.String">null</Field>
 <Field name="EncKeyVect" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[763d4c3f-1d65-46a8-b259-3f57b6558ba6]]></Field>
	<Field name="ITxt" type="com.sunopsis.sql.DbInt"><![CDATA[3617]]></Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[108]]></Field>
	<Field name="SqlIndGrp" type="java.lang.String"><![CDATA[0]]></Field>
 <Field name="Txt" type="java.lang.String"><![CDATA[10/28/2016 - Erik Wilkins
* Commented out ssl.nb_run filter condition

10/25/2016 - Erik Wilkins
* Updated STRT from 'SIEBEL' to ' INTO ' to allow for other schemas
* Added DFLT_MSG to beginning to avoid variable failure when detail message can't be found

10/24/2016 - Erik Wilkins
Created variable with refreshing query of 
/*--------------*/
select 
REPLACE(MAX(SYS_CONNECT_BY_PATH(chr(13) || sess_name || ' inserted ' || nb_err || ' rows into ' || substr(def_txt, STRT, STP - STRT), ','))
  KEEP (DENSE_RANK LAST ORDER BY curr), ',') AS LP_WARNING_MSG
from
(SELECT 
  sli.global_id,
  sli.load_plan_name,
  lsl.start_date,
  ss.sess_name,
  sstl.def_txt, 
  instr(sstl.def_txt, 'SIEBEL') STRT, 
  instr(sstl.def_txt, '(') STP,
  sstl.nb_err,
  ROW_NUMBER() OVER (PARTITION BY sli.global_id ORDER BY sstl.task_beg) AS curr,
  ROW_NUMBER() OVER (PARTITION BY sli.global_id ORDER BY sstl.task_beg) - 1 AS prev
  from snp_lp_inst sli 
  join snp_lpi_step_log lsl
  on sli.i_lp_inst = lsl.i_lp_inst
  join snp_session ss
  on lsl.sess_no = ss.sess_no
  join snp_step_log ssl
  on lsl.sess_no = ssl.sess_no
  join snp_sess_task_log sstl
  on ssl.sess_no = sstl.sess_no
  and ssl.nno = sstl.nno
  and ssl.nb_run = sstl.nb_run
  where sli.global_id = '<%=odiRef.getLoadPlanInstance("BATCH_GUID")%>'
  and ssl.nb_run = '<%=odiRef.getLoadPlanInstance("RESTART_ATTEMPTS")%>'
  and lsl.status = 'M'
  and ssl.nb_err > 0
  and sstl.nb_err > 0
  and upper(sstl.def_txt) like '%INSERT%E$%'
  )
group by global_id
CONNECT BY prev = PRIOR curr AND global_id = PRIOR global_id
START WITH curr = 1]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpOrigTxt">
		<Field name="GlobalId" type="java.lang.String">null</Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[108]]></Field>
	<Field name="OrigineName" type="java.lang.String"><![CDATA[Variable description]]></Field>
	<Field name="SnpsCol" type="java.lang.String"><![CDATA[I_TXT_VAR]]></Field>
	<Field name="SnpsTable" type="java.lang.String"><![CDATA[SNP_VAR]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpTxtHeader">
		<Field name="Enc" type="java.lang.String">null</Field>
	<Field name="EncKey" type="java.lang.String">null</Field>
 <Field name="EncKeyVect" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[5aff5f8e-db71-4d11-b7e4-15d28b8f2fc2]]></Field>
	<Field name="ITxt" type="com.sunopsis.sql.DbInt"><![CDATA[3618]]></Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[128]]></Field>
	<Field name="SqlIndGrp" type="java.lang.String"><![CDATA[2]]></Field>
 <Field name="Txt" type="java.lang.String"><![CDATA[select nvl(actl_msg.LP_WARNING_MSG, dflt_msg.txt)
from
(select ' ' txt from dual) dflt_msg
left outer join
(select 
  REPLACE(MAX(SYS_CONNECT_BY_PATH(chr(13) || sess_name || ' inserted ' || nb_err || ' rows into ' || substr(def_txt, STRT, STP - STRT), ','))
    KEEP (DENSE_RANK LAST ORDER BY curr), ',') AS LP_WARNING_MSG
  from
  (SELECT 
    sli.global_id,
    sli.load_plan_name,
    lsl.start_date,
    ss.sess_name,
    sstl.def_txt, 
    instr(upper(sstl.def_txt), ' INTO ') + 6 STRT, 
    instr(sstl.def_txt, '(') STP,
    sstl.nb_err,
    ROW_NUMBER() OVER (PARTITION BY sli.global_id ORDER BY sstl.task_beg) AS curr,
    ROW_NUMBER() OVER (PARTITION BY sli.global_id ORDER BY sstl.task_beg) - 1 AS prev
    from snp_lp_inst sli 
    join snp_lpi_step_log lsl
    on sli.i_lp_inst = lsl.i_lp_inst
    join snp_session ss
    on lsl.sess_no = ss.sess_no
    join snp_step_log ssl
    on lsl.sess_no = ssl.sess_no
    join snp_sess_task_log sstl
    on ssl.sess_no = sstl.sess_no
    and ssl.nno = sstl.nno
    and ssl.nb_run = sstl.nb_run
    where sli.global_id = '<%=odiRef.getLoadPlanInstance("BATCH_GUID")%>'
    --and ssl.nb_run = '<%=odiRef.getLoadPlanInstance("RESTART_ATTEMPTS")%>'
    and lsl.status = 'M'
    and ssl.nb_err > 0
    and sstl.nb_err > 0
    and upper(sstl.def_txt) like '%INSERT%E$%'
    )
  group by global_id
  CONNECT BY prev = PRIOR curr AND global_id = PRIOR global_id
  START WITH curr = 1
) actl_msg
on 1=1]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpOrigTxt">
		<Field name="GlobalId" type="java.lang.String">null</Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[128]]></Field>
	<Field name="OrigineName" type="java.lang.String"><![CDATA[Variable Query]]></Field>
	<Field name="SnpsCol" type="java.lang.String"><![CDATA[I_TXT_VAR_IN]]></Field>
	<Field name="SnpsTable" type="java.lang.String"><![CDATA[SNP_VAR]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_TXTHEADER.3618]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[5aff5f8e-db71-4d11-b7e4-15d28b8f2fc2]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_TXTHEADER.3617]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[763d4c3f-1d65-46a8-b259-3f57b6558ba6]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.DwgExportSummary">
		<Field name="ExpTxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="InstObjNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="JoinColNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="JoinNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="KeyColNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="KeyNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="LinkDiagNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="MorigTxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="MtxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="OrigTxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[2]]></Field>
	<Field name="OtherObjectsNb" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="PlanAgentNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="StepNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="TxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[2]]></Field>
	<Field name="UeOrigNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="UeUsedNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="VarPlanAgentNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenTxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="OdiVersion" type="java.lang.String"><![CDATA[12.2.1]]></Field>
	<Field name="OriginRepositoryID" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="RepositoryVersion" type="java.lang.String"><![CDATA[05.02.02.08]]></Field>
</Object>
</SunopsisExport>
